<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>GatePlan</title>
  <meta name="theme-color" content="#101828">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">
</head>
<body>
  <div id="app-shell">
    <header class="app-header" role="banner">
      <div class="brand">
        <span class="logo">‚è≥</span>
        <div>
          <h1>GatePlan</h1>
          <p class="tagline">Intentional days start here</p>
        </div>
      </div>
      <div class="header-meta">
        <span id="dateInfo" class="date"></span>
        <span id="streakInfo" class="streak">Streak: 0 üî•</span>
      </div>
      <button id="installBtn" class="ghost hidden" type="button">Install</button>
    </header>

    <!-- Persistent offline indicator for upgraded PWA feedback -->
    <div id="offlineBanner" class="offline-banner" role="status" aria-live="polite">
      <span class="dot"></span>
      <span id="offlineText">Working offline</span>
    </div>

    <nav class="tab-bar" role="tablist" aria-label="GatePlan views">
      <button class="tab-button active" id="tab-plan" type="button" role="tab" aria-selected="true" aria-controls="view-plan" data-tab="plan">Plan</button>
      <button class="tab-button" id="tab-today" type="button" role="tab" aria-controls="view-today" data-tab="today">Today</button>
      <button class="tab-button" id="tab-pool" type="button" role="tab" aria-controls="view-pool" data-tab="pool">Task Pool</button>
      <button class="tab-button" id="tab-checkin" type="button" role="tab" aria-controls="view-checkin" data-tab="checkin">Check-in</button>
      <button class="tab-button" id="tab-review" type="button" role="tab" aria-controls="view-review" data-tab="review">Weekly Review</button>
      <button class="tab-button" id="tab-settings" type="button" role="tab" aria-controls="view-settings" data-tab="settings">Settings</button>
    </nav>

    <main class="views" role="main">
      <!-- Morning gate overlay keeps the habit strong -->
      <section id="gate" class="overlay hidden" aria-hidden="true">
        <div class="overlay-card" role="dialog" aria-modal="true" aria-labelledby="gateTitle">
          <h2 id="gateTitle">Morning gate</h2>
          <p>Plan at least <strong id="minTaskRequirement">one task</strong> before the day begins.</p>
          <button id="gateGo" class="primary" type="button">Plan today‚Äôs focus</button>
        </div>
      </section>

      <!-- Plan view -->
      <section id="view-plan" class="view visible" role="tabpanel" aria-labelledby="tab-plan" tabindex="-1">
        <div class="card intro">
          <h2>Plan your deep work</h2>
          <p class="muted">Grab tasks from your pool, set the intention, and lock in today‚Äôs focus.</p>
        </div>
        <div class="card coach-card">
          <header class="card-header">
            <div>
              <h3>AI planning coach</h3>
              <p class="muted" id="coachSummary">Let GatePlan study your habits to prime the perfect morning.</p>
            </div>
            <div class="card-actions inline">
              <button id="coachRefresh" type="button">Refresh suggestions</button>
              <button id="coachApply" class="primary" type="button">Apply to plan</button>
            </div>
          </header>
          <ul id="coachSuggestionList" class="list coach-list"></ul>
          <div id="coachAlerts" class="coach-alert" role="status" aria-live="polite"></div>
        </div>
        <div class="card">
          <form id="planForm" class="responsive-grid" autocomplete="off">
            <label class="field">
              <span class="label">Pick a task</span>
              <select id="planTaskSelect"></select>
            </label>
            <label class="field">
              <span class="label">Start time</span>
              <input type="time" id="planStartTime">
            </label>
            <label class="field">
              <span class="label">Duration (min)</span>
              <input type="number" id="planDuration" min="5" step="5" placeholder="30">
            </label>
            <div class="field add-actions">
              <button id="addToToday" class="primary" type="button">Add to today</button>
            </div>
          </form>
        </div>

        <div class="card">
          <header class="card-header">
            <div>
              <h3>Today‚Äôs plan</h3>
              <p class="muted" id="planSummary">No tasks yet.</p>
            </div>
            <div class="progress-pill" aria-live="polite">
              <span id="planProgressLabel">0/0</span>
              <div class="progress-track" aria-hidden="true">
                <div id="planProgressBar" class="progress-fill" style="width:0%"></div>
              </div>
            </div>
          </header>
          <ul id="todayPlanList" class="list"></ul>
          <div class="card-actions">
            <button id="finishPlanning" class="primary" type="button">Lock plan ‚úÖ</button>
          </div>
        </div>
        <div class="card calendar-card">
          <header class="card-header">
            <div>
              <h3>Calendar sync</h3>
              <p class="muted" id="calendarSyncSummary">Pull existing events to avoid collisions.</p>
            </div>
            <div class="card-actions inline">
              <button id="calendarImportBtn" type="button">Import calendar</button>
              <input id="calendarImportFile" type="file" accept="text/calendar" hidden>
              <button id="calendarAutoAdjust" type="button">Auto-adjust plan</button>
            </div>
          </header>
          <ul id="calendarConflictList" class="list"></ul>
        </div>
      </section>

      <!-- Today view -->
      <section id="view-today" class="view" role="tabpanel" aria-labelledby="tab-today" tabindex="-1">
        <div class="card">
          <header class="card-header">
            <div>
              <h2>Today</h2>
              <p class="muted">Stay on track and celebrate progress.</p>
            </div>
            <div class="progress-pill">
              <span id="todayProgressLabel">0/0</span>
              <div class="progress-track" aria-hidden="true">
                <div id="todayProgressBar" class="progress-fill" style="width:0%"></div>
              </div>
            </div>
          </header>
          <ul id="todayLiveList" class="list"></ul>
          <div id="focusEffortStats" class="focus-effort" aria-live="polite"></div>
        </div>
        <div class="card focus-card">
          <header class="card-header">
            <div>
              <h3>Focus timer</h3>
              <p class="muted">Track real effort and feed the live dashboard automatically.</p>
            </div>
            <div class="badge" id="focusTimerMode">Pomodoro 25:5</div>
          </header>
          <div class="focus-timer-grid">
            <label class="field">
              <span class="label">Task to focus on</span>
              <select id="focusTimerTask"></select>
            </label>
            <div class="timer-display" id="focusTimerDisplay">00:00</div>
            <div class="card-actions inline">
              <button id="focusTimerStart" class="primary" type="button">Start</button>
              <button id="focusTimerPause" type="button">Pause</button>
              <button id="focusTimerReset" type="button">Log session</button>
            </div>
          </div>
          <ul id="focusTimerLog" class="list focus-log"></ul>
        </div>
        <div class="card gamification-card">
          <header class="card-header">
            <div>
              <h3>Momentum &amp; rewards</h3>
              <p class="muted">Level up streak mastery with badges and seasonal quests.</p>
            </div>
            <div class="badge" id="gamificationLevel">Lvl 1</div>
          </header>
          <div id="gamificationSummary" class="gamification-summary"></div>
        </div>
      </section>

      <!-- Task pool view -->
      <section id="view-pool" class="view" role="tabpanel" aria-labelledby="tab-pool" tabindex="-1">
        <div class="card">
          <h2>Task pool</h2>
          <p class="muted">Capture repeatable actions so planning stays fast.</p>
          <form id="poolForm" class="responsive-grid" autocomplete="off">
            <label class="field">
              <span class="label">Title</span>
              <input id="poolTitle" placeholder="e.g., 30 minute reading block">
            </label>
            <label class="field">
              <span class="label">Default duration (min)</span>
              <input id="poolDuration" type="number" min="5" step="5" placeholder="30">
            </label>
            <label class="field">
              <span class="label">Due date</span>
              <input id="poolDue" type="date">
            </label>
            <label class="field">
              <span class="label">Tags</span>
              <input id="poolTags" placeholder="focus, study">
            </label>
            <div class="field add-actions">
              <button id="addPoolTask" class="primary" type="button">Add to pool</button>
            </div>
          </form>
        </div>
        <div class="card">
          <h3>Saved tasks</h3>
          <ul id="poolList" class="list"></ul>
        </div>
      </section>

      <!-- Evening check-in -->
      <section id="view-checkin" class="view" role="tabpanel" aria-labelledby="tab-checkin" tabindex="-1">
        <div class="card">
          <h2>Evening check-in</h2>
          <p class="muted">Reflect and log why items stuck or slipped. Multiple reasons and notes encouraged.</p>
          <div class="card section signal-section">
            <h3>Daily signals</h3>
            <div class="responsive-grid">
              <label class="field">
                <span class="label">Energy</span>
                <input type="range" id="energyLevel" min="1" max="5" value="3">
                <span class="muted" id="energyLabel">Balanced</span>
              </label>
              <label class="field">
                <span class="label">Mood</span>
                <select id="moodState">
                  <option value="uplifted">Uplifted</option>
                  <option value="steady">Steady</option>
                  <option value="stressed">Stressed</option>
                  <option value="fatigued">Fatigued</option>
                </select>
              </label>
              <label class="field">
                <span class="label">Biometrics / wearable note</span>
                <input id="biometricInput" placeholder="HRV 72, sleep 7h, steps 9k">
              </label>
            </div>
          </div>
          <ul id="checkinList" class="list"></ul>
          <div class="card section">
            <label class="field checkbox">
              <input type="checkbox" id="tomorrowFree">
              <span>Make tomorrow a free day</span>
            </label>
          </div>
          <button id="submitCheckin" class="primary" type="button">Submit check-in</button>
          <p id="checkinResult" class="muted" role="status" aria-live="polite"></p>
          <div id="signalInsight" class="signal-insight"></div>
        </div>
      </section>

      <!-- Weekly review -->
      <section id="view-review" class="view" role="tabpanel" aria-labelledby="tab-review" tabindex="-1">
        <div class="card">
          <h2>Weekly review</h2>
          <p class="muted">Zoom out to spot trends, celebrate streaks, and notice blockers.</p>
          <div class="review-grid">
            <div class="review-card">
              <h3>Daily success rate</h3>
              <ul id="dailySuccessList" class="stat-list"></ul>
            </div>
            <div class="review-card">
              <h3>Top reasons</h3>
              <ul id="topReasonsList" class="stat-list"></ul>
            </div>
            <div class="review-card">
              <h3>Streak history</h3>
              <div id="streakSummary" class="streak-summary"></div>
            </div>
            <div class="review-card">
              <h3>Predictive trends</h3>
              <ul id="predictiveList" class="stat-list"></ul>
            </div>
            <div class="review-card">
              <h3>Personalized coaching</h3>
              <ul id="coachTipsList" class="stat-list"></ul>
            </div>
            <div class="review-card">
              <h3>Anomaly alerts</h3>
              <ul id="anomalyList" class="stat-list"></ul>
            </div>
            <div class="review-card">
              <h3>Signal correlations</h3>
              <ul id="signalCorrelationList" class="stat-list"></ul>
            </div>
            <div class="review-card">
              <h3>Focus vs schedule</h3>
              <ul id="focusDriftList" class="stat-list"></ul>
            </div>
          </div>
        </div>
      </section>

      <!-- Settings -->
      <section id="view-settings" class="view" role="tabpanel" aria-labelledby="tab-settings" tabindex="-1">
        <div class="card">
          <h2>Settings</h2>
          <div class="settings-grid">
            <label class="field">
              <span class="label">Morning gate hour</span>
              <input type="time" id="morningHour" value="07:00">
            </label>
            <label class="field">
              <span class="label">Minimum tasks required</span>
              <input type="number" id="minTasks" min="1" max="10" value="1">
            </label>
            <label class="field">
              <span class="label">Calendar links</span>
              <select id="calLinks">
                <option value="on">On</option>
                <option value="off">Off</option>
              </select>
            </label>
            <label class="field">
              <span class="label">Streak success threshold</span>
              <select id="streakThreshold">
                <option value="0.6">60%</option>
                <option value="0.7">70%</option>
                <option value="0.8">80%</option>
                <option value="0.9">90%</option>
                <option value="1">100%</option>
              </select>
            </label>
            <label class="field">
              <span class="label">Theme</span>
              <select id="themeChoice">
                <option value="system">Follow system</option>
                <option value="light">Light</option>
                <option value="dark">Dark</option>
              </select>
            </label>
            <label class="field">
              <span class="label">Accent color</span>
              <input type="color" id="accentColor" value="#6366f1">
            </label>
            <label class="field">
              <span class="label">Enable coach auto-reshuffle</span>
              <select id="autoReshuffle">
                <option value="on">On</option>
                <option value="off">Off</option>
              </select>
            </label>
            <label class="field">
              <span class="label">Pomodoro length (minutes)</span>
              <input type="number" id="pomodoroLength" min="10" max="60" value="25">
            </label>
            <label class="field">
              <span class="label">Short break (minutes)</span>
              <input type="number" id="shortBreakLength" min="3" max="20" value="5">
            </label>
            <label class="field">
              <span class="label">Long break (minutes)</span>
              <input type="number" id="longBreakLength" min="5" max="30" value="15">
            </label>
          </div>
          <div class="card-actions">
            <button id="saveSettings" class="primary" type="button">Save settings</button>
          </div>
        </div>
        <div class="card">
          <h3>Backup &amp; restore</h3>
          <p class="muted">Everything stays on your device. Export a backup or bring one back.</p>
          <div class="card-actions">
            <button id="exportData" type="button">Export JSON</button>
            <button id="importData" type="button">Import JSON</button>
            <input id="importFile" type="file" accept="application/json" hidden>
          </div>
        </div>
      </section>
    </main>

    <footer class="app-footer" role="contentinfo">
      <span id="lastSync" class="muted">Local-first, auto-saved</span>
    </footer>
  </div>

  <canvas id="confettiCanvas" class="confetti hidden" aria-hidden="true"></canvas>
  <script src="app.js" type="module"></script>
</body>
</html>
